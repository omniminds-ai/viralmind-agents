# Conversation API

## Overview

The Conversation API provides endpoints for submitting messages to challenges and handling AI agent interactions, including tool calls and VNC actions.

## Base Path

```
/api/conversation
```

## Endpoints

### POST /submit/:id

Submits a message to a specific challenge and streams back the AI response.

#### URL Parameters

- `id` (required): The ID of the challenge to submit a message to

#### Request Body

- `prompt` (required): The message content to submit
- `signature` (required): The blockchain transaction signature
- `walletAddress` (required): The wallet address of the sender

#### Response

A streaming response that includes:

- Initial response with empty content and screenshot information
- Text chunks as they are generated by the AI
- Tool call results and actions
- Error messages if any occur during processing

The response is sent as a text/event-stream.

#### Authentication

Authentication is handled through blockchain transaction verification:
- The signature must be valid
- The transaction must be verified against the tournament PDA
- The transaction must include the correct entry fee
- The wallet address must match the transaction

#### Error Responses

- `400 Bad Request`: Missing required fields
- `400 Bad Request`: Duplicate signature
- `400 Bad Request`: Tournament data not found
- `400 Bad Request`: Entry fee not found in tournament data
- `400 Bad Request`: Various error messages for invalid parameters or server issues

#### Processing Details

1. Validates the request data and challenge status
2. Verifies the blockchain transaction
3. Captures a screenshot from the VNC session
4. Applies tournament prompt filters
5. Constructs the LLM context with system prompt and chat history
6. Creates a user message entry in the database
7. Initializes an assistant message entry
8. Streams the AI response, handling tool calls and actions
9. Updates the database with the final assistant message
10. Handles retries with exponential backoff if errors occur
11. Updates tournament scores if the challenge uses score-based expiry
